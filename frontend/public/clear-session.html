<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Limpar Sess√£o - Astra Campaign</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
        }
        
        button {
            padding: 12px 24px;
            margin: 10px 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .info-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        
        .error-box {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .success-box {
            background: #d4edda;
            border-left-color: #28a745;
        }
        
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîß Diagn√≥stico e Limpeza de Sess√£o</h1>

        <div id="result"></div>

        <h2>A√ß√µes Dispon√≠veis:</h2>
        <button class="btn-danger" onclick="clearSession()">üóëÔ∏è Limpar Sess√£o Completa</button>
        <button class="btn-primary" onclick="checkSession()">üîç Verificar Sess√£o Atual</button>
        <button class="btn-success" onclick="goToLogin()">üîê Ir para Login</button>

        <div class="info-box">
            <h3>‚ÑπÔ∏è O que faz cada a√ß√£o:</h3>
            <ul>
                <li>
                    <strong>Limpar Sess√£o:</strong> Remove todos os dados de autentica√ß√£o do navegador
                </li>
                <li><strong>Verificar Sess√£o:</strong> Mostra informa√ß√µes sobre o token atual</li>
                <li><strong>Ir para Login:</strong> Redireciona para a p√°gina de login</li>
            </ul>
        </div>
    </div>

    <script>
        function clearSession() {
            const result = document.getElementById('result');

            // Remover todos os itens do localStorage
            const itemsBefore = Object.keys(localStorage);
            localStorage.clear();

            result.innerHTML = `
                <div class="success-box">
                    <h3>‚úÖ Sess√£o Limpa com Sucesso!</h3>
                    <p>Itens removidos: ${itemsBefore.length}</p>
                    <ul>${itemsBefore.map((key) => `<li>${key}</li>`).join('')}</ul>
                    <p><strong>Voc√™ ser√° redirecionado para o login em 3 segundos...</strong></p>
                </div>
            `;

        setTimeout(() => {
          window.location.href = '/';
        }, 3000);
      }

      function checkSession() {
        const result = document.getElementById('result');
        const token = localStorage.getItem('auth_token');

        if (token) {
          try {
            // Decodificar JWT (sem verifica√ß√£o)
            const parts = token.split('.');
            if (parts.length === 3) {
              const payload = JSON.parse(atob(parts[1]));

              const now = Math.floor(Date.now() / 1000);
              const expired = payload.exp && payload.exp < now;

              result.innerHTML = `
                            <div class="${expired ? 'error-box' : 'info-box'}">
                                <h3>üîç Informa√ß√µes do Token:</h3>
                                <p><strong>Status:</strong> ${expired ? '‚ùå EXPIRADO' : '‚úÖ V√°lido'}</p>
                                <p><strong>Usu√°rio ID:</strong> ${payload.userId || 'N/A'}</p>
                                <p><strong>Email:</strong> ${payload.email || 'N/A'}</p>
                                <p><strong>Role:</strong> ${payload.role || 'N/A'}</p>
                                <p><strong>Tenant ID:</strong> ${payload.tenantId || 'N/A'}</p>
                                ${payload.exp ? `<p><strong>Expira em:</strong> ${new Date(payload.exp * 1000).toLocaleString()}</p>` : ''}
                                ${expired ? '<p style="color: red;"><strong>‚ö†Ô∏è Este token expirou! Fa√ßa login novamente.</strong></p>' : ''}
                                <h4>Payload Completo:</h4>
                                <pre>${JSON.stringify(payload, null, 2)}</pre>
                            </div>
                        `;
            } else {
              result.innerHTML = `
                            <div class="error-box">
                                <h3>‚ùå Token Inv√°lido</h3>
                                <p>O token n√£o possui o formato JWT correto.</p>
                                <p><strong>Recomenda√ß√£o:</strong> Limpe a sess√£o e fa√ßa login novamente.</p>
                            </div>
                        `;
            }
          } catch (error) {
            result.innerHTML = `
                        <div class="error-box">
                            <h3>‚ùå Erro ao Decodificar Token</h3>
                            <p>${error.message}</p>
                            <p><strong>Recomenda√ß√£o:</strong> Limpe a sess√£o e fa√ßa login novamente.</p>
                        </div>
                    `;
          }
        } else {
          result.innerHTML = `
                    <div class="info-box">
                        <h3>‚ÑπÔ∏è Nenhuma Sess√£o Ativa</h3>
                        <p>N√£o h√° token de autentica√ß√£o armazenado.</p>
                        <p><strong>A√ß√£o:</strong> Fa√ßa login para criar uma nova sess√£o.</p>
                    </div>
                `;
        }
      }

      function goToLogin() {
        window.location.href = '/';
      }

      // Verificar automaticamente ao carregar
      window.onload = checkSession;
    </script>
</body>

</html>



